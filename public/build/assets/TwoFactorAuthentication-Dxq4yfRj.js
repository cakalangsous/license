import{u as N,r as y,a as V,o as u,b as H,d as s,i as b,g as t,e as n,l,t as $,f as i,k as L,F as P,j as U,m as j,U as _}from"./app-B4kXJm1R.js";import{q as F}from"./index-CSEUMRIG.js";import{_ as E}from"./Card-CWZ0FrNR.js";import{_ as d}from"./Button-BorMZ65S.js";import{_ as R}from"./FormInput-DnkblmfP.js";import{_ as O}from"./Modal-D0MHrs78.js";import"./keyboard-BDssWLgB.js";const m=o=>({url:m.url(o),method:"post"});m.definition={methods:["post"],url:"/admin/two-factor-authentication"};m.url=o=>m.definition.url+F(o);m.post=o=>({url:m.url(o),method:"post"});const f=o=>({url:f.url(o),method:"post"});f.definition={methods:["post"],url:"/admin/two-factor-authentication/confirm"};f.url=o=>f.definition.url+F(o);f.post=o=>({url:f.url(o),method:"post"});const c=o=>({url:c.url(o),method:"delete"});c.definition={methods:["delete"],url:"/admin/two-factor-authentication"};c.url=o=>c.definition.url+F(o);c.delete=o=>({url:c.url(o),method:"delete"});const p=o=>({url:p.url(o),method:"post"});p.definition={methods:["post"],url:"/admin/two-factor-authentication/recovery-codes"};p.url=o=>p.definition.url+F(o);p.post=o=>({url:p.url(o),method:"post"});const v=o=>({url:v.url(o),method:"post"});v.definition={methods:["post"],url:"/admin/two-factor-authentication/regenerate-recovery-codes"};v.url=o=>v.definition.url+F(o);v.post=o=>({url:v.url(o),method:"post"});const S={enable:m,confirm:f,disable:c,recoveryCodes:p,regenerateRecoveryCodes:v},z={key:0},I={key:1},Q={class:"mb-4"},G=["innerHTML"],J={class:"mt-2 text-sm text-gray-600"},K={class:"flex gap-2"},W={key:2},X={class:"flex gap-2"},Y={key:0,class:"mt-4 p-4 bg-gray-100 rounded text-sm"},Z={class:"grid grid-cols-2 gap-2"},ee={class:"space-y-4"},ie={__name:"TwoFactorAuthentication",props:{user:Object},setup(o){const x=N(),g=y(!1),h=y(null),q=y(null),A=y([]),T=y(!1),k=V({code:"",secret:""}),w=V({password:""}),C=y(!1),D=async()=>{g.value=!0;try{const a=await _.post(S.enable.url());h.value=a.data.svg,confirming.value=!0}catch(a){console.error("Failed to enable 2FA",a),x.error("Failed to generate 2FA secret.")}finally{g.value=!1}},B=()=>{_.post(S.recoveryCodes.url(),{password:prompt("Please confirm your password")}).then(a=>{A.value=a.data,T.value=!0}).catch(a=>{x.error("Invalid password or failed to fetch codes.")})},M=()=>{w.delete(route("admin.two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{C.value=!1,x.success("Two factor authentication disabled."),w.reset()}})};return(a,e)=>(u(),H(E,{title:"Two Factor Authentication"},{default:s(()=>[!o.user.two_factor_confirmed_at&&!g.value?(u(),b("div",z,[e[9]||(e[9]=t("p",{class:"text-sm text-gray-600 mb-4"}," Add additional security to your account using two factor authentication. ",-1)),n(d,{onClick:D},{default:s(()=>[...e[8]||(e[8]=[l("Enable 2FA",-1)])]),_:1})])):g.value?(u(),b("div",I,[t("div",Q,[e[11]||(e[11]=t("p",{class:"font-semibold mb-2"}," Scan this QR code with your authenticator app: ",-1)),t("div",{innerHTML:h.value,class:"bg-white p-4 inline-block"},null,8,G),t("div",J,[e[10]||(e[10]=l(" Or enter this key manually: ",-1)),t("strong",null,$(q.value),1)])]),t("form",{onSubmit:e[2]||(e[2]=L((...r)=>a.confirmTwoFactor&&a.confirmTwoFactor(...r),["prevent"])),class:"space-y-4 max-w-xs"},[n(R,{modelValue:i(k).code,"onUpdate:modelValue":e[0]||(e[0]=r=>i(k).code=r),label:"Verification Code",error:i(k).errors.code,placeholder:"123456",required:""},null,8,["modelValue","error"]),t("div",K,[n(d,{type:"submit",loading:i(k).processing},{default:s(()=>[...e[12]||(e[12]=[l("Confirm",-1)])]),_:1},8,["loading"]),n(d,{variant:"secondary",onClick:e[1]||(e[1]=r=>g.value=!1)},{default:s(()=>[...e[13]||(e[13]=[l("Cancel",-1)])]),_:1})])],32)])):(u(),b("div",W,[e[18]||(e[18]=t("p",{class:"text-sm text-green-600 mb-4 font-semibold"}," Two factor authentication is enabled. ",-1)),t("div",X,[n(d,{variant:"outline-secondary",onClick:B},{default:s(()=>[...e[14]||(e[14]=[l("Show Recovery Codes",-1)])]),_:1}),n(d,{variant:"danger",onClick:e[3]||(e[3]=r=>C.value=!0)},{default:s(()=>[...e[15]||(e[15]=[l("Disable 2FA",-1)])]),_:1})]),T.value?(u(),b("div",Y,[e[17]||(e[17]=t("p",{class:"font-bold mb-2"},"Recovery Codes:",-1)),t("ul",Z,[(u(!0),b(P,null,U(A.value,r=>(u(),b("li",{key:r,class:"font-mono"},$(r),1))),128))]),n(d,{size:"xs",variant:"text",class:"mt-2",onClick:e[4]||(e[4]=r=>T.value=!1)},{default:s(()=>[...e[16]||(e[16]=[l("Hide",-1)])]),_:1})])):j("",!0)])),n(O,{show:C.value,title:"Disable Two Factor Authentication",onClose:e[7]||(e[7]=r=>C.value=!1)},{footer:s(()=>[n(d,{variant:"secondary",onClick:e[6]||(e[6]=r=>C.value=!1)},{default:s(()=>[...e[20]||(e[20]=[l("Cancel",-1)])]),_:1}),n(d,{variant:"danger",loading:i(w).processing,onClick:M},{default:s(()=>[...e[21]||(e[21]=[l("Disable",-1)])]),_:1},8,["loading"])]),default:s(()=>[t("div",ee,[e[19]||(e[19]=t("p",null," Are you sure you want to disable 2FA? This will lower your account security. ",-1)),n(R,{modelValue:i(w).password,"onUpdate:modelValue":e[5]||(e[5]=r=>i(w).password=r),type:"password",label:"Confirm Password",error:i(w).errors.password,required:""},null,8,["modelValue","error"])])]),_:1},8,["show"])]),_:1}))}};export{ie as default};
