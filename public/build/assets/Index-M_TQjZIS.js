import{u as F,a as O,r as k,o as _,b as j,d as o,e as r,f as l,h as I,g as d,l as v,t as n,i as x,m as h,n as w,k as G,p as V}from"./app-B4kXJm1R.js";import{q as H,k as J,s as K,t as Q,d as W,_ as X}from"./AdminLayout-Dl7j7Lml.js";import{_ as Y}from"./Card-CWZ0FrNR.js";import{_ as y}from"./Button-BorMZ65S.js";import{_ as Z}from"./DataTable-CQkKoL2v.js";import{_ as g}from"./FormInput-DnkblmfP.js";import{_ as $}from"./FormSelect-BRGdU3AD.js";import{_ as A}from"./Modal-D0MHrs78.js";import{r as ee}from"./TrashIcon-CSwwSb2h.js";import"./UserGroupIcon-CyxjldZw.js";import"./ArrowLeftIcon-C4pIvMX3.js";import"./DemoBanner-5gPpdzaD.js";import"./XMarkIcon-BknwjWvY.js";import"./TagIcon-D0dlpqbY.js";import"./index-CSEUMRIG.js";import"./keyboard-BDssWLgB.js";const te={class:"flex items-center justify-between w-full"},se={class:"text-sm bg-secondary-100 dark:bg-secondary-800 px-2 py-1 rounded"},le={class:"font-medium"},ae={key:0,class:"text-sm text-secondary-500"},re={class:"capitalize"},oe={class:"font-medium"},de={class:"text-blue-500"},ne={class:"flex items-center gap-1"},ue=["href"],ie=["onClick"],ce=["onClick"],pe=["onClick"],me=["onClick"],be=["onClick"],_e={class:"grid grid-cols-2 gap-4"},ve={class:"grid grid-cols-2 gap-4"},ye={class:"grid grid-cols-2 gap-4"},ge={class:"grid grid-cols-2 gap-4"},De={__name:"Index",props:{title:{type:String,default:"Licenses"},licenses:{type:Object,default:()=>({})},products:{type:Array,default:()=>[]},marketplaces:{type:Array,default:()=>[]}},setup(m){const c=F(),U=[{key:"purchase_code",label:"Purchase Code",sortable:!0},{key:"buyer_email",label:"Buyer",sortable:!0},{key:"product.name",label:"Product",sortable:!1},{key:"license_type",label:"Type",sortable:!0},{key:"prod_activations",label:"Prod",sortable:!1},{key:"dev_activations",label:"Dev",sortable:!1},{key:"support_status",label:"Support",sortable:!1},{key:"status",label:"Status",sortable:!0},{key:"action",label:"Action",sortable:!1,searchable:!1}],s=O({product_id:"",marketplace_id:"",purchase_code:"",buyer_email:"",buyer_name:"",buyer_username:"",license_type:"regular",purchased_at:"",supported_until:"",status:"active",notes:""}),p=k(null),u=k(!1),b=k(!1),f=k(null),C=()=>{s.reset(),p.value=null},B=()=>{C(),u.value=!0},E=a=>{var t,e;p.value=a.id,s.product_id=a.product_id,s.marketplace_id=a.marketplace_id,s.purchase_code=a.purchase_code,s.buyer_email=a.buyer_email,s.buyer_name=a.buyer_name||"",s.buyer_username=a.buyer_username||"",s.license_type=a.license_type,s.purchased_at=((t=a.purchased_at)==null?void 0:t.split("T")[0])||"",s.supported_until=((e=a.supported_until)==null?void 0:e.split("T")[0])||"",s.status=a.status,s.notes=a.notes||"",u.value=!0},L=()=>{p.value?s.put(`/admin/licenses/${p.value}`,{preserveScroll:!0,onSuccess:()=>{c.success("License updated successfully"),u.value=!1,C()}}):s.post("/admin/licenses",{preserveScroll:!0,onSuccess:()=>{c.success("License created successfully"),u.value=!1,C()}})},q=a=>{f.value=a,b.value=!0},T=()=>{f.value&&V.delete(`/admin/licenses/${f.value.id}`,{onSuccess:()=>{c.success("License deleted successfully"),b.value=!1,f.value=null}})},D=a=>{confirm("Are you sure you want to revoke this license?")&&V.post(`/admin/licenses/${a.id}/revoke`,{},{onSuccess:()=>c.success("License revoked")})},P=a=>{V.post(`/admin/licenses/${a.id}/suspend`,{},{onSuccess:()=>c.success("License suspended")})},M=a=>{V.post(`/admin/licenses/${a.id}/reactivate`,{},{onSuccess:()=>c.success("License reactivated")})},N=a=>{const t={active:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",suspended:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",revoked:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",expired:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"};return t[a]||t.expired},S=a=>{const t={active:{class:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",label:"Active"},expiring:{class:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",label:"Expiring"},expired:{class:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",label:"Expired"},lifetime:{class:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",label:"Lifetime"}};return t[a]||t.expired},z=[{value:"regular",label:"Regular (1 domain)"},{value:"extended",label:"Extended (5 domains)"}],R=[{value:"active",label:"Active"},{value:"suspended",label:"Suspended"},{value:"revoked",label:"Revoked"},{value:"expired",label:"Expired"}];return(a,t)=>(_(),j(X,{title:m.title},{default:o(()=>[r(l(I),{title:m.title},null,8,["title"]),r(Y,null,{header:o(()=>[d("div",te,[t[14]||(t[14]=d("span",{class:"font-semibold"},"Licenses",-1)),r(y,{onClick:B},{default:o(()=>[...t[13]||(t[13]=[v("Add License",-1)])]),_:1})])]),default:o(()=>[r(Z,{"paginated-data":m.licenses,columns:U},{"cell-purchase_code":o(({row:e})=>[d("code",se,n(e.purchase_code.substring(0,8))+"... ",1)]),"cell-buyer_email":o(({row:e})=>[d("div",null,[d("p",le,n(e.buyer_email),1),e.buyer_name?(_(),x("p",ae,n(e.buyer_name),1)):h("",!0)])]),"cell-license_type":o(({row:e})=>[d("span",re,n(e.license_type),1)]),"cell-prod_activations":o(({row:e})=>{var i;return[d("span",oe,n(e.production_activations_count||0)+" / "+n(((i=e.product)==null?void 0:i.extended_domains_limit)||1),1)]}),"cell-dev_activations":o(({row:e})=>[d("span",de,n(e.local_activations_count||0),1)]),"cell-support_status":o(({row:e})=>[d("span",{class:w(["px-2 py-1 rounded-full text-xs font-medium",S(e.support_status).class])},n(S(e.support_status).label),3)]),"cell-status":o(({row:e})=>[d("span",{class:w(["px-2 py-1 rounded-full text-xs font-medium capitalize",N(e.status)])},n(e.status),3)]),"cell-action":o(({row:e})=>[d("div",ne,[d("a",{href:`/admin/licenses/${e.id}`,class:"p-1.5 rounded hover:bg-secondary-100 dark:hover:bg-secondary-700 text-secondary-600 dark:text-secondary-400",title:"View"},[r(l(H),{class:"w-5 h-5"})],8,ue),d("button",{onClick:i=>E(e),class:"p-1.5 rounded hover:bg-secondary-100 dark:hover:bg-secondary-700 text-primary",title:"Edit"},[r(l(J),{class:"w-5 h-5"})],8,ie),e.status==="active"?(_(),x("button",{key:0,onClick:i=>P(e),class:"p-1.5 rounded hover:bg-yellow-100 dark:hover:bg-yellow-900/30 text-yellow-600",title:"Suspend"},[r(l(K),{class:"w-5 h-5"})],8,ce)):h("",!0),e.status==="suspended"?(_(),x("button",{key:1,onClick:i=>M(e),class:"p-1.5 rounded hover:bg-green-100 dark:hover:bg-green-900/30 text-green-600",title:"Reactivate"},[r(l(Q),{class:"w-5 h-5"})],8,pe)):h("",!0),e.status!=="revoked"?(_(),x("button",{key:2,onClick:i=>D(e),class:"p-1.5 rounded hover:bg-red-100 dark:hover:bg-red-900/30 text-danger",title:"Revoke"},[r(l(W),{class:"w-5 h-5"})],8,me)):h("",!0),d("button",{onClick:i=>q(e),class:"p-1.5 rounded hover:bg-red-100 dark:hover:bg-red-900/30 text-danger",title:"Delete"},[r(l(ee),{class:"w-5 h-5"})],8,be)])]),_:1},8,["paginated-data"])]),_:1}),r(A,{show:u.value,title:p.value?"Edit License":"Add License",onClose:t[10]||(t[10]=e=>u.value=!1),size:"lg"},{footer:o(()=>[r(y,{variant:"outline-secondary",onClick:t[9]||(t[9]=e=>u.value=!1),class:"mr-2"},{default:o(()=>[...t[15]||(t[15]=[v("Cancel",-1)])]),_:1}),r(y,{onClick:L,loading:l(s).processing},{default:o(()=>[v(n(p.value?"Update":"Create"),1)]),_:1},8,["loading"])]),default:o(()=>[d("form",{onSubmit:G(L,["prevent"]),class:"space-y-4"},[d("div",_e,[r($,{modelValue:l(s).product_id,"onUpdate:modelValue":t[0]||(t[0]=e=>l(s).product_id=e),label:"Product",options:m.products.map(e=>({value:e.id,label:e.name})),error:l(s).errors.product_id,required:""},null,8,["modelValue","options","error"]),r($,{modelValue:l(s).marketplace_id,"onUpdate:modelValue":t[1]||(t[1]=e=>l(s).marketplace_id=e),label:"Marketplace",options:m.marketplaces.map(e=>({value:e.id,label:e.name})),error:l(s).errors.marketplace_id,required:""},null,8,["modelValue","options","error"])]),r(g,{modelValue:l(s).purchase_code,"onUpdate:modelValue":t[2]||(t[2]=e=>l(s).purchase_code=e),label:"Purchase Code",error:l(s).errors.purchase_code,required:""},null,8,["modelValue","error"]),d("div",ve,[r(g,{modelValue:l(s).buyer_email,"onUpdate:modelValue":t[3]||(t[3]=e=>l(s).buyer_email=e),label:"Buyer Email",type:"email",error:l(s).errors.buyer_email,required:""},null,8,["modelValue","error"]),r(g,{modelValue:l(s).buyer_name,"onUpdate:modelValue":t[4]||(t[4]=e=>l(s).buyer_name=e),label:"Buyer Name",error:l(s).errors.buyer_name},null,8,["modelValue","error"])]),d("div",ye,[r($,{modelValue:l(s).license_type,"onUpdate:modelValue":t[5]||(t[5]=e=>l(s).license_type=e),label:"License Type",options:z,error:l(s).errors.license_type,required:""},null,8,["modelValue","error"]),r($,{modelValue:l(s).status,"onUpdate:modelValue":t[6]||(t[6]=e=>l(s).status=e),label:"Status",options:R,error:l(s).errors.status,required:""},null,8,["modelValue","error"])]),d("div",ge,[r(g,{modelValue:l(s).purchased_at,"onUpdate:modelValue":t[7]||(t[7]=e=>l(s).purchased_at=e),label:"Purchased At",type:"date",error:l(s).errors.purchased_at,required:""},null,8,["modelValue","error"]),r(g,{modelValue:l(s).supported_until,"onUpdate:modelValue":t[8]||(t[8]=e=>l(s).supported_until=e),label:"Support Expires",type:"date",error:l(s).errors.supported_until},null,8,["modelValue","error"])])],32)]),_:1},8,["show","title"]),r(A,{show:b.value,title:"Delete License",onClose:t[12]||(t[12]=e=>b.value=!1)},{footer:o(()=>[r(y,{variant:"outline-secondary",onClick:t[11]||(t[11]=e=>b.value=!1),class:"mr-2"},{default:o(()=>[...t[16]||(t[16]=[v("Cancel",-1)])]),_:1}),r(y,{variant:"danger",onClick:T},{default:o(()=>[...t[17]||(t[17]=[v("Delete",-1)])]),_:1})]),default:o(()=>[t[18]||(t[18]=d("p",null," Are you sure you want to delete this license? All activations will also be removed. ",-1))]),_:1},8,["show"])]),_:1},8,["title"]))}};export{De as default};
