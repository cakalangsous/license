import{u as B,r as g,D as N,a as R,o as q,b as S,d as b,e as l,f as n,h as E,g as t,l as w,y,z as h,k as T,p as O}from"./app-CXYNX7l5.js";import{o as I,m as M,n as P,_ as j}from"./AdminLayout-BzX5vIWh.js";import{_ as G}from"./Card-B-peCzvN.js";import{_ as U}from"./Button-D7awOZ5r.js";import{_ as C}from"./FormInput-hNOoRqIu.js";import{_ as z,a as L}from"./CrudFieldRow-CfMrsvZQ.js";import{c as D}from"./index-BITrN0ZQ.js";import{d as H}from"./vuedraggable.umd-C0q7mJ5h.js";import"./UserGroupIcon-B_Y3lvxt.js";import"./ArrowLeftIcon-Bt2tPfv5.js";import"./TrashIcon-DePSIVFn.js";import"./DemoBanner-B-KdNamD.js";import"./XMarkIcon-CPBrcqh9.js";import"./TagIcon-C8r8ihxU.js";import"./index-CSEUMRIG.js";import"./keyboard-CcDRV2PE.js";const J={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},K={class:"flex items-start gap-3 p-4 mb-6 text-sm text-amber-800 rounded-lg bg-amber-50 dark:bg-amber-900/50 dark:text-amber-300",role:"alert"},Q={class:"mb-6"},W={class:"mb-6"},X={class:"flex flex-wrap gap-6"},Y={class:"inline-flex items-center cursor-pointer group"},Z={class:"inline-flex items-center cursor-pointer group"},ee={class:"inline-flex items-center cursor-pointer group"},te={class:"inline-flex items-center cursor-pointer group"},re={class:"mb-6"},ae={class:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700"},le={class:"w-full text-sm text-left"},se={class:"mt-4"},oe={class:"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700"},ke={__name:"Edit",props:{title:{type:String,default:"Edit CRUD"},crud:{type:Object,required:!0},fields:{type:Array,default:()=>[]},input_types:{type:Array,default:()=>[]},all_validations:{type:Array,default:()=>[]},available_tables:{type:Array,default:()=>[]}},setup(f){const s=f,u=B(),c=g(s.crud.model_name||""),m=g(s.crud.table_name||""),v=g(s.crud.builder_options||"generate_crud"),x=g(!!s.crud.soft_deletes),i=N({create:!!s.crud.create_page,edit:!!s.crud.edit_page,show:!!s.crud.show_page});let k=0;const d=g(s.fields.length>0?s.fields.map(p=>({_id:++k,...p,input_type:String(p.input_type)})):[]),V=()=>{d.value.push({_id:++k,field_name:"",field_type:"string",default_value:"none",defined_value:"",input_type:"",table_ref:"",value_field_ref:"",label_field_ref:"",where_field_ref:"",custom_options:[],validations:[],row_create_page:!0,row_edit_page:!0,row_list_page:!0,row_details_page:!0,searchable:!0,sortable:!0})};d.value.length===0&&V();const r=R({model_name:"",table_name:"",builder_options:"generate_crud",soft_deletes:!1,create_page:!0,edit_page:!0,show_page:!0,field_name:[],field_type:[],default_value:[],defined_value:[],input_type:[],row_create_page:[],row_edit_page:[],row_list_page:[],row_details_page:[],searchable:[],sortable:[],validations:[],table_ref:[],value_field_ref:[],label_field_ref:[],where_field_ref:[],custom_options:[]}),F=()=>{if(!c.value||!c.value.trim())return u.error("Model name is required"),!1;if(!m.value||!m.value.trim())return u.error("Table name is required"),!1;if(d.value.length===0)return u.error("At least one field is required"),!1;const p=d.value.filter(e=>e.field_name&&e.field_name.trim());if(p.length===0)return u.error("At least one field with a name is required"),!1;for(let e=0;e<p.length;e++){const a=p[e];if(!a.input_type)return u.error(`Field "${a.field_name}": Input type is required`),!1}return!0},A=()=>{if(!F())return;r.model_name=c.value,r.table_name=m.value,r.builder_options=v.value,r.soft_deletes=x.value,r.create_page=i.create,r.edit_page=i.edit,r.show_page=i.show,r.field_name=[],r.field_type=[],r.default_value=[],r.defined_value=[],r.input_type=[],r.row_create_page=[],r.row_edit_page=[],r.row_list_page=[],r.row_details_page=[],r.searchable=[],r.sortable=[],r.validations=[],r.table_ref=[],r.value_field_ref=[],r.label_field_ref=[],r.where_field_ref=[],r.custom_options=[],d.value.filter(e=>e.field_name&&e.field_name.trim()).forEach(e=>{r.field_name.push(e.field_name),r.field_type.push(e.field_type),r.default_value.push(e.default_value),r.defined_value.push(e.defined_value||""),r.input_type.push(e.input_type),r.row_create_page.push(e.row_create_page),r.row_edit_page.push(e.row_edit_page),r.row_list_page.push(e.row_list_page),r.row_details_page.push(e.row_details_page),r.searchable.push(e.searchable),r.sortable.push(e.sortable),r.table_ref.push(e.table_ref||""),r.value_field_ref.push(e.value_field_ref||""),r.label_field_ref.push(e.label_field_ref||""),r.where_field_ref.push(e.where_field_ref||""),r.custom_options.push(e.custom_options||[]);const a=[];e.validations.forEach(o=>{if(o.is_input_able&&o.value){let _={};_[o.id]=o.value,a.push(_)}else a.push(o.id)}),r.validations.push(a)}),r.put(D.update.url(s.crud.id),{onSuccess:()=>{u.success("CRUD updated successfully! Files regenerated."),O.visit(D.index.url())},onError:e=>{e.message?u.error(e.message):u.error("Failed to update CRUD. Check console for details."),console.error(e)}})},$=[{value:"generate_crud",label:"Generate CRUD"},{value:"generate_api",label:"Generate API"},{value:"generate_crud_api",label:"Generate CRUD & API"}];return(p,e)=>(q(),S(j,{title:f.title},{default:b(()=>[l(n(E),{title:f.title},null,8,["title"]),l(G,{title:f.title},{default:b(()=>[t("form",{onSubmit:T(A,["prevent"])},[t("div",J,[l(C,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),label:"Model Name",placeholder:"e.g. Customer (singular)",required:"",error:n(r).errors.model_name,disabled:""},null,8,["modelValue","error"]),l(C,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),label:"Table Name",placeholder:"e.g. customers",required:"",error:n(r).errors.table_name,disabled:""},null,8,["modelValue","error"])]),t("div",K,[l(n(I),{class:"w-5 h-5 shrink-0 mt-0.5"}),e[8]||(e[8]=t("div",null,[t("span",{class:"font-medium"},"Note:"),w(" Model name and table name cannot be changed during edit. This will regenerate all CRUD files with the updated field configuration. ")],-1))]),t("div",Q,[l(z,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),label:"Builder Options",options:$,error:n(r).errors.builder_options},null,8,["modelValue","error"])]),t("div",W,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"}," Options ",-1)),t("div",X,[t("label",Y,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),class:"sr-only peer"},null,512),[[h,x.value]]),e[9]||(e[9]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"},null,-1)),e[10]||(e[10]=t("span",{class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},"Soft Deletes",-1))]),t("label",Z,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=a=>i.create=a),class:"sr-only peer"},null,512),[[h,i.create]]),e[11]||(e[11]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"},null,-1)),e[12]||(e[12]=t("span",{class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},"Create Page",-1))]),t("label",ee,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>i.edit=a),class:"sr-only peer"},null,512),[[h,i.edit]]),e[13]||(e[13]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"},null,-1)),e[14]||(e[14]=t("span",{class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},"Edit Page",-1))]),t("label",te,[y(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>i.show=a),class:"sr-only peer"},null,512),[[h,i.show]]),e[15]||(e[15]=t("div",{class:"relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"},null,-1)),e[16]||(e[16]=t("span",{class:"ms-3 text-sm font-medium text-gray-900 dark:text-gray-300"},"Show Page",-1))])])]),t("div",re,[e[20]||(e[20]=t("h4",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Fields ",-1)),t("div",ae,[t("table",le,[e[18]||(e[18]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-800 dark:text-gray-400"},[t("tr",null,[t("th",{scope:"col",class:"px-2 py-3 w-10"},[t("span",{class:"sr-only"},"Drag")]),t("th",{scope:"col",class:"px-3 py-3"}," Field Name "),t("th",{scope:"col",class:"px-3 py-3"}," DB Type "),t("th",{scope:"col",class:"px-3 py-3"}," Default "),t("th",{scope:"col",class:"px-3 py-3"}," Input Type "),t("th",{scope:"col",class:"px-3 py-3"}," Validation "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Create "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Edit "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," List "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Details "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Search "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Sort "),t("th",{scope:"col",class:"px-3 py-3 text-center"}," Action ")])],-1)),l(n(H),{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value=a),tag:"tbody","item-key":"_id",handle:".drag-handle",animation:200,"ghost-class":"opacity-50",class:"bg-white dark:bg-gray-900"},{item:b(({element:a,index:o})=>[l(L,{index:o,field:a,"input-types":f.input_types,"all-validations":f.all_validations,"available-tables":f.available_tables,"can-delete":o>0,"onUpdate:field":_=>Object.assign(d.value[o],_),onRemove:_=>d.value.splice(o,1)},null,8,["index","field","input-types","all-validations","available-tables","can-delete","onUpdate:field","onRemove"])]),_:1},8,["modelValue"])])]),t("div",se,[l(U,{type:"button",onClick:V,variant:"outline-primary",size:"sm"},{default:b(()=>[l(n(M),{class:"w-4 h-4 mr-1"}),e[19]||(e[19]=w(" Add Field ",-1))]),_:1})])]),t("div",oe,[l(U,{type:"submit",loading:n(r).processing,variant:"primary"},{default:b(()=>[l(n(P),{class:"w-4 h-4 mr-2"}),e[21]||(e[21]=w(" Update CRUD ",-1))]),_:1},8,["loading"])])],32)]),_:1},8,["title"])]),_:1},8,["title"]))}};export{ke as default};
